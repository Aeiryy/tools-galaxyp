<tool id="pout2mzid" name="Pout2mzid" version="0.3.03">
    <requirements>
	    <requirement type="package" version="0.3.03">pout2mzid</requirement>
    </requirements>
    <description>add Percolator scoring to mzIdentML</description>
    <command>
    #if $mzid.multifile
    mkdir p2m_mzid_in;
    #set digits = "0" + str(len(str(len($mzid.mzids.keys()))))
    #for $i, $fn in $enumerate($mzid.mzids.keys())
    #set prefixnum = format($i, $digits)
    ln -s $mzid.mzids[$fn] p2m_mzid_in/`basename $mzid.mzids[$fn]`;
    #end for
    ls p2m_mzid_in > infiles.txt;
    pout2mzid -p $percout -i p2m_mzid_in -f infiles.txt -o p2m_result -c _perco
    #else
    pout2mzid -p $percout -m $mzid.mzidsingle > $output_single
    #end if
    #if $targetdecoy == "decoy"
    -d
    #end if
    #if $schemaskip
    -v
    #end if
    </command>
    <inputs>
	    <param name="percout" type="data" format="percout" label="Percolator output"/>
            <conditional name="mzid">
            <param name="multifile" type="boolean" label="Multiple mzIdentML files?" />
            <when value="true">
	        <param name="mzids" type="data_collection" format="mzid" label="mzIdentML from MSGF+" />
            </when>
            <when value="false">
	        <param name="mzidsingle" type="data" format="mzid" label="mzIdentML from MSGF+" />
            </when>
            </conditional>
	    <param name="targetdecoy" type="select" display="radio" label="Which features to add to mzIdentML" >
		<option value="target" selected="true">Target</option>
		<option value="decoy">Decoy</option>
	    </param>
	    <param name="schemaskip" type="boolean" label="Skip percolator schema validation?" />
    </inputs>
    <outputs>
	    <data name="output_single" format="mzid">
               <filter>mzid['multifile'] == False</filter>
            </data>
	    <collection name="pout2mzid" type="list">
                <filter>mzid['multifile'] == True</filter>
                <discover_datasets pattern="__designation__" ext="mzid" directory="p2m_result" />
           </collection>
            
    </outputs>
    <help>Pout2Mzid extracts statistics from a percolator input file, and writes them to the mzIdentML file(s) that have been used
	  to generate the percolator data.</help>
</tool>
